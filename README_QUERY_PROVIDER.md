# Query Provider —Å —É–º–Ω–æ–π —Å–±–æ—Ä–∫–æ–π –º—É—Å–æ—Ä–∞

–õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–∏—Å–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–æ–π –º—É—Å–æ—Ä–∞ (GC), –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–∏—Å–æ–≤** –ø–æ –∫–ª—é—á—É
- ‚úÖ **–£–º–Ω–∞—è GC** - —É–¥–∞–ª–µ–Ω–∏–µ –∫–µ—à–∞ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏** —á–µ—Ä–µ–∑ `useQuery`
- ‚úÖ **–†–∞—Å—à–∞—Ä–∏–≤–∞–Ω–∏–µ –∫–µ—à–∞** –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ **TypeScript** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ **20 comprehensive —Ç–µ—Å—Ç–æ–≤** —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º
- ‚úÖ **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å** - ~200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
import { QueryProvider, useQuery } from "./QueryProvider";
import { use, Suspense } from "react";

function App() {
  return (
    <QueryProvider>
      <Suspense fallback="Loading...">
        <UserProfile userId="123" />
      </Suspense>
    </QueryProvider>
  );
}

function UserProfile({ userId }) {
  const promise = useQuery({
    key: ["user", userId],
    queryFn: () => fetch(`/api/users/${userId}`).then((r) => r.json()),
    gcTime: 5000, // –ö–µ—à —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫ –ø–æ—Å–ª–µ unmount
  });

  const user = use(promise);
  return <div>{user.name}</div>;
}
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[USAGE.md](./USAGE.md)** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- **[CHANGES.md](./CHANGES.md)** - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –º–∏–≥—Ä–∞—Ü–∏—è
- **[IMPLEMENTATION_SUMMARY.md](./IMPLEMENTATION_SUMMARY.md)** - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä
- **[TEST_README.md](./TEST_README.md)** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
npm run test          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
npm run test:ui       # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å UI
```

**20 —Ç–µ—Å—Ç–æ–≤** –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

- ‚úÖ –ë–∞–∑–æ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ GC –±–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ GC —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ (3 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è useQuery (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (3 —Ç–µ—Å—Ç–∞)

## üé® API

### QueryProvider

```tsx
<QueryProvider>{children}</QueryProvider>
```

### useQuery

```typescript
const promise = useQuery({
  key: Array<unknown>, // –ö–ª—é—á –∫–µ—à–∞
  queryFn: (key) => Promise, // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  gcTime: number, // –í—Ä–µ–º—è –¥–æ —É–¥–∞–ª–µ–Ω–∏—è (–º—Å)
});
```

## üí° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç GC

### –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

**GC —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫!**

```
Component Mount
‚Üì
Subscribe (subscriptions = 1)
‚Üì
GC Timer CANCELLED ‚ùå
‚Üì
Component Unmount
‚Üì
Unsubscribe (subscriptions = 0)
‚Üì
GC Timer STARTED ‚úÖ
‚Üì
After gcTime
‚Üì
Cache Deleted üóëÔ∏è
```

### –ü—Ä–∏–º–µ—Ä

```tsx
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç A –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
<UserProfile userId="123" />
// ‚Üí subscriptions = 1
// ‚Üí GC —Ç–∞–π–º–µ—Ä –ù–ï –∑–∞–ø—É—â–µ–Ω ‚ùå

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç B —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ
<UserName userId="123" />
// ‚Üí subscriptions = 2
// ‚Üí GC —Ç–∞–π–º–µ—Ä –ù–ï –∑–∞–ø—É—â–µ–Ω ‚ùå

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç A —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
// ‚Üí subscriptions = 1
// ‚Üí GC —Ç–∞–π–º–µ—Ä –ù–ï –∑–∞–ø—É—â–µ–Ω ‚ùå

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç B —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
// ‚Üí subscriptions = 0
// ‚Üí GC —Ç–∞–π–º–µ—Ä –ó–ê–ü–£–©–ï–ù ‚úÖ

// –ß–µ—Ä–µ–∑ gcTime –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
// ‚Üí –ö–µ—à —É–¥–∞–ª–µ–Ω üóëÔ∏è
```

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ QueryProvider.tsx      # –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚≠ê
‚îú‚îÄ‚îÄ App.tsx                # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ App.test.tsx           # 20 —Ç–µ—Å—Ç–æ–≤ ‚úÖ
‚îî‚îÄ‚îÄ test/
    ‚îî‚îÄ‚îÄ setup.ts           # Setup –¥–ª—è —Ç–µ—Å—Ç–æ–≤

vitest.config.ts           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vitest
package.json               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + —Å–∫—Ä–∏–ø—Ç—ã
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∞—Å—à–∞—Ä–∏–≤–∞–Ω–∏–µ –∫–µ—à–∞

```tsx
// fetchUser –≤—ã–∑–æ–≤–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –û–î–ò–ù —Ä–∞–∑!
function UserCard({ userId }) {
  return (
    <>
      <Avatar userId={userId} />
      <Name userId={userId} />
    </>
  );
}

function Avatar({ userId }) {
  const promise = useQuery({
    key: ["user", userId], // ‚Üê –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–ª—é—á
    queryFn: () => fetchUser(userId),
    gcTime: 5000,
  });
  const user = use(promise);
  return <img src={user.avatar} />;
}

function Name({ userId }) {
  const promise = useQuery({
    key: ["user", userId], // ‚Üê –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–ª—é—á
    queryFn: () => fetchUser(userId),
    gcTime: 5000,
  });
  const user = use(promise);
  return <span>{user.name}</span>;
}
```

### –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```tsx
// üîÑ –ö—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π (1 —Å–µ–∫)
const live = useQuery({
  key: ["live"],
  queryFn: fetchLive,
  gcTime: 1000,
});

// ‚è±Ô∏è –°—Ä–µ–¥–Ω–∏–π (30 —Å–µ–∫)
const user = useQuery({
  key: ["user", id],
  queryFn: () => fetchUser(id),
  gcTime: 30000,
});

// ‚ôæÔ∏è –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π
const config = useQuery({
  key: ["config"],
  queryFn: fetchConfig,
  // gcTime –Ω–µ —É–∫–∞–∑–∞–Ω = –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –∫–µ—à
});

// ‚ö° –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
const sensitive = useQuery({
  key: ["sensitive"],
  queryFn: fetchSensitive,
  gcTime: 0,
});
```

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

|                       | QueryProvider | TanStack Query |
| --------------------- | ------------- | -------------- |
| –†–∞–∑–º–µ—Ä                | ~200 —Å—Ç—Ä–æ–∫    | ~50KB          |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ           | ‚úÖ            | ‚úÖ             |
| GC –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥–ø–∏—Å–æ–∫ | ‚úÖ            | ‚ùå             |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–µ—Ç—á | ‚ùå            | ‚úÖ             |
| –ú—É—Ç–∞—Ü–∏–∏               | ‚ùå            | ‚úÖ             |
| DevTools              | ‚ùå            | ‚úÖ             |
| React 19 `use()`      | ‚úÖ            | ‚ùå             |

## üö¶ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ QueryProvider –µ—Å–ª–∏:

- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø
- ‚úÖ –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –∫–µ—à –ø—Ä–æ–º–∏—Å–æ–≤
- ‚úÖ –†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ –∫—Ä–∏—Ç–∏—á–µ–Ω
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ React 19+

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TanStack Query –µ—Å–ª–∏:

- ‚úÖ –°–ª–æ–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ –ù—É–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ñ–µ—Ç—á–∏
- ‚úÖ –ù—É–∂–Ω—ã –º—É—Ç–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ù—É–∂–Ω—ã DevTools

## üìù –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `addPromise` –Ω–∞ –æ–±—ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
2. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `useQuery` –Ω–∞ –æ–±—ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è `gcTime`
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
5. ‚úÖ GC –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
6. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞/–æ—Ç–ø–∏—Å–∫–∞ –≤ `useQuery`
7. ‚úÖ 20 comprehensive —Ç–µ—Å—Ç–æ–≤
8. ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîß –°–∫—Ä–∏–ø—Ç—ã

```bash
npm run dev        # –ó–∞–ø—É—Å–∫ –≤ dev —Ä–µ–∂–∏–º–µ
npm run build      # –°–±–æ—Ä–∫–∞ –¥–ª—è production
npm run test       # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm run test:ui    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å UI
npm run lint       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](./USAGE.md)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä](./IMPLEMENTATION_SUMMARY.md)
- [–°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π](./CHANGES.md)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º](./TEST_README.md)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è React 19+**
